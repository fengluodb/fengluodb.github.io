<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Mit 6.824系列(二): Lab1 MapReduce | 枫落的博客</title>
    <meta property="og:title" content="Mit 6.824系列(二): Lab1 MapReduce - 枫落的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2022-04-04T18:47:45&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2022-04-04T18:47:45&#43;08:00'>
        
    <meta name="Keywords" content="golang">
    <meta name="description" content="Mit 6.824系列(二): Lab1 MapReduce">
        
    <meta name="author" content="枫落">
    <meta property="og:url" content="https://fengluodb.github.io/post/lab1/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://fengluodb.github.io">
                        枫落的博客
                    </a>
                
                <p class="description">热爱编程，专注Go语言开发</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://fengluodb.github.io">首页</a>
                    
                    <a  href="https://fengluodb.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://fengluodb.github.io/series/" title="系列">系列</a>
                    
                    <a  href="https://fengluodb.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
<link rel="stylesheet" href="https://at.alicdn.com/t/font_2466059_nt8cfy5z5tl.css">
<style>
    #log ul {
        padding: 0;
    }

    #log .log-ul {
        height: 340px;
        width: 165px;
        padding: 10px 0;
        overflow: scroll;
        list-style: none;
        border: 1px solid lightgray;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 5px 10px 5px lightslategray;
    }

    #log .log-ul a {
        transition: all ease-out 0.3s;
    }

    #log .log-ul::-webkit-scrollbar {
        width: 4px;
        height: 0px;
    }

    #log .log-ul::-webkit-scrollbar-thumb {
        border-radius: 2px;
        background: #d1d4db;
    }

    #log li {
        padding-left: 10px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: #000;
        border-radius: 10px;
    }

    #log li ul {
        border-radius: 10px;
    }

    #log a {
        padding: 10px;
        display: inline-block;
        width: 130px;
        border-radius: 10px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-family: Arial;
    }

    .myfont {
        font-family: Arial;
        color: #999;
        font-weight: bold;
    }

    #log li ul a {
        padding: 2px 10px;
        font-size: 13px;
    }

    @media(hover:hover) and (pointer:fine) {
        #log a:hover {
            background-color: rgb(44, 136, 194);
            color: #fff;
            cursor: pointer;
        }
    }

    #body #log {
        position: fixed;
        top: 10rem;
        right: 0;
        z-index: 2;
    }

    #body #log .btn {
        margin-right: 2rem;
        width: 50px;
        height: 50px;
        text-align: center;
        line-height: 50px;
    }

    .invisible {
        display: none;
    }

    #hide {
        position: relative;
        bottom: 5px;
        left: 57.5px;
    }

    #log .iconfont {
        color: rgb(44, 136, 194);
        font-size: 34px;
        border-radius: 50%;
        border: 1px solid lightgray;
        box-shadow: 5px 6px 5px lightblue;
        cursor: pointer;
    }

    .bgc {
        background-color: rgb(44, 136, 194);
        color: white;
    }
</style>

<div id="log">
    <div class="btn invisible" id="show"><i class="iconfont icon-jiantou"></i></div>
    <ul class="log-ul"></ul>
    <div class="btn" id="hide"><i class="iconfont icon-jiantouarrow503"></i></div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        $("#log .btn").click(function () {
            $("#log>ul").toggleClass("invisible");
            $("#log .btn").toggleClass("invisible")
        })
        
        let children = $(".post-content").eq(0).children();
        let h2s = [];
        let currentH2 = {};
        for (let i = 0; i < children.length; i++) {
            let child = children[i];
            if (child.tagName == "H3") {
                currentH2.h3s.push(child);
            } else if (child.tagName == "H2") {
                child.h3s = [];
                h2s.push(child);
                currentH2 = child
            }
        }
        
        let i = 0;
        for (let h2 of h2s) {
            let h2_box = $("<li></li>")
            $("#log .log-ul").eq(0).append(h2_box);
            let jump = $(`<a href=#${h2.id} class=${h2.id}><span class="myfont">${++i}</span>&ensp;<strong>${h2.innerHTML}</strong></a>`);
            h2_box.append(jump);
            let h3_box = $("<ul></ul>")
            h2_box.append(h3_box);
            let j = 1;
            for (let h3 of h2.h3s) {
                h3_box.append(`<li><a href=#${h3.id} class="${h3.id}"><span class="myfont">${(i)}.${(j++)}</span>&ensp;${h3.innerHTML}</a></li>`)
            }
        }
        //平滑过度
        $('#log a').click(function () {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top - 100
            }, 500);
            return false;
        });

        let titles = $("h2,h3");
        //页面导航标签高亮
        $(window).scroll(function () {
            let wst = $(window).scrollTop();
            let len = titles.length;
            for (let i = 0; i < len; i++) {
                let title = titles.eq(i);
                if (title.offset().top - wst > 102) {
                    if (i == 0) {
                        $(`#log a`).removeClass("bgc");
                        $(`#log .${title.attr("id")}`).addClass("bgc");
                        continue;
                    }
                    let pre = titles.eq(i - 1);
                    if (pre.offset().top - wst <= 102) {
                        $(`#log a`).removeClass("bgc");
                        $(`#log .${pre.attr("id")}`).addClass("bgc");
                    }
                } else {
                    if (i == len - 1) {
                        $(`#log a`).removeClass("bgc");
                        $(`#log .${title.attr("id")}`).addClass("bgc");
                        continue;
                    }
                    let next = titles.eq(i + 1);
                    if (next.offset().top - 102 - wst >= 0) {
                        $(`#log a`).removeClass("bgc");
                        $(`#log .${next.attr("id")}`).addClass('bgc');
                    }
                }
            }
        })
        //移动端默认则关闭toc目录
        if (/phone|pad|pod|iPhone|iPod|ios|iPad|Android|Fennec|BlackBerry|Mobile|IEMobile|MQQBrowser|JUC|Fennec|WosBrowser|BrowserNG|WebOS|Symbian|Windows Phone/i.test(navigator.userAgent)) {
            $("#log>ul").toggleClass("invisible");
            $("#log .btn").toggleClass("invisible");
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">Mit 6.824系列(二): Lab1 MapReduce</h1>
        </header>
        <date class="post-meta meta-date">
            2022年4月4日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/golang'>golang</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <p>本文介绍6.824的第一个实验 —— MapReduce的实现过程。</p>
<h2 id="实验要求">实验要求</h2>
<blockquote>
<p>Your job is to implement a distributed MapReduce, consisting of two programs, the coordinator and the worker. There will be just one coordinator process, and one or more worker processes executing in parallel. In a real system the workers would run on a bunch of different machines, but for this lab you&rsquo;ll run them all on a single machine. The workers will talk to the coordinator via RPC. Each worker process will ask the coordinator for a task, read the task&rsquo;s input from one or more files, execute the task, and write the task&rsquo;s output to one or more files. The coordinator should notice if a worker hasn&rsquo;t completed its task in a reasonable amount of time (for this lab, use ten seconds), and give the same task to a different worker.</p>
</blockquote>
<p>你的工作是实现一个分布式的MapReduce。它由两个程序组成，<code>coordinator</code>（协调者）和 <code>worker</code>（工作者）。实验中只有一个协调者进程，但有一个或多个并行执行的工作者进程。在一个真实的系统中，工作者进程会在一堆不同的机器上运行，但在这个实验室中，你将在一台机器上运行它们。工作者将通过RPC与协调者对话。每个工作进程将向调度者请求一个任务，从一个或多个文件中读取任务的输入，执行任务，并将任务的输出写入一个或多个文件中。如果一个工作进程在合理的时间内没有完成其任务（在本实验室中，使用10秒），协调者应该注意到，并将相同的任务交给不同的工作进程。</p>
<blockquote>
<p>We have given you a little code to start you off. The &ldquo;main&rdquo; routines for the coordinator and worker are in <code>main/mrcoordinator.go</code> and <code>main/mrworker.go</code>; don&rsquo;t change these files. You should put your implementation in <code>mr/coordinator.go</code>, <code>mr/worker.go</code>, and <code>mr/rpc.go</code>.</p>
</blockquote>
<p>我们已经给了你一点代码，让你开始工作。协调者和工作者的 &ldquo;主要 &ldquo;例程在<code>main/mrcoordinator.go</code>和<code>main/mrworker.go</code>中；不要改变这些文件。你应该把你的实现放在<code>mr/coordinator.go</code>、<code>mr/worker.go和mr/rpc.go</code>。</p>
<h2 id="整体流程">整体流程</h2>
<p>关于如何完成这个实验，<a href="https://pdos.csail.mit.edu/6.824/labs/lab-mr.html">lab1的课程主页</a>中给予了足够的提示。首先，我们阅读 <code>src/main/mrsequential.go</code>，它是mapreduce的简单单线程实现。</p>
<h3 id="mrsequentialgo源码解读"><code>mrsequential.go</code>源码解读</h3>
<p><code>mrsequential.go</code>的代码逻辑十分简单，我们直接从<code>main</code>函数中的代码开始解读。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">if</span> <span style="color:#a90d91">len</span>(<span style="color:#000">os</span>.<span style="color:#000">Args</span>) &lt; <span style="color:#1c01ce">3</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#000">fmt</span>.<span style="color:#000">Fprintf</span>(<span style="color:#000">os</span>.<span style="color:#000">Stderr</span>, <span style="color:#c41a16">&#34;Usage: mrsequential xxx.so inputfiles...\n&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span>.<span style="color:#000">Exit</span>(<span style="color:#1c01ce">1</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">mapf</span>, <span style="color:#000">reducef</span> <span style="color:#000">:=</span> <span style="color:#000">loadPlugin</span>(<span style="color:#000">os</span>.<span style="color:#000">Args</span>[<span style="color:#1c01ce">1</span>])
</span></span></code></pre></div><p>这部分代码是准备阶段，通过命令行传入的参数，加载对应的 <code>mapf</code>、<code>reducef</code>函数。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#177500">//
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// read each input file,
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// pass it to Map,
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// accumulate the intermediate Map output.
</span></span></span><span style="display:flex;"><span><span style="color:#177500">//
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#000">intermediate</span> <span style="color:#000">:=</span> []<span style="color:#000">mr</span>.<span style="color:#000">KeyValue</span>{}
</span></span><span style="display:flex;"><span><span style="color:#a90d91">for</span> <span style="color:#000">_</span>, <span style="color:#000">filename</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">os</span>.<span style="color:#000">Args</span>[<span style="color:#1c01ce">2</span>:] {
</span></span><span style="display:flex;"><span>	<span style="color:#000">file</span>, <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">os</span>.<span style="color:#000">Open</span>(<span style="color:#000">filename</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#000">log</span>.<span style="color:#000">Fatalf</span>(<span style="color:#c41a16">&#34;cannot open %v&#34;</span>, <span style="color:#000">filename</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#000">content</span>, <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">ioutil</span>.<span style="color:#000">ReadAll</span>(<span style="color:#000">file</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#000">log</span>.<span style="color:#000">Fatalf</span>(<span style="color:#c41a16">&#34;cannot read %v&#34;</span>, <span style="color:#000">filename</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#000">file</span>.<span style="color:#000">Close</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#000">kva</span> <span style="color:#000">:=</span> <span style="color:#000">mapf</span>(<span style="color:#000">filename</span>, <span style="color:#a90d91">string</span>(<span style="color:#000">content</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#000">intermediate</span> = <span style="color:#a90d91">append</span>(<span style="color:#000">intermediate</span>, <span style="color:#000">kva</span><span style="color:#000">...</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这部分代码是map阶段，调用<code>mapf</code>函数对每个文件的内容进行处理，生成中间键并保存。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">sort</span>.<span style="color:#000">Sort</span>(<span style="color:#000">ByKey</span>(<span style="color:#000">intermediate</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">oname</span> <span style="color:#000">:=</span> <span style="color:#c41a16">&#34;mr-out-0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">ofile</span>, <span style="color:#000">_</span> <span style="color:#000">:=</span> <span style="color:#000">os</span>.<span style="color:#000">Create</span>(<span style="color:#000">oname</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">//
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// call Reduce on each distinct key in intermediate[],
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// and print the result to mr-out-0.
</span></span></span><span style="display:flex;"><span><span style="color:#177500">//
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#000">i</span> <span style="color:#000">:=</span> <span style="color:#1c01ce">0</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">for</span> <span style="color:#000">i</span> &lt; <span style="color:#a90d91">len</span>(<span style="color:#000">intermediate</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#000">j</span> <span style="color:#000">:=</span> <span style="color:#000">i</span> <span style="color:#000">+</span> <span style="color:#1c01ce">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">for</span> <span style="color:#000">j</span> &lt; <span style="color:#a90d91">len</span>(<span style="color:#000">intermediate</span>) <span style="color:#000">&amp;&amp;</span> <span style="color:#000">intermediate</span>[<span style="color:#000">j</span>].<span style="color:#000">Key</span> <span style="color:#000">==</span> <span style="color:#000">intermediate</span>[<span style="color:#000">i</span>].<span style="color:#000">Key</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#000">j</span><span style="color:#000">++</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#000">values</span> <span style="color:#000">:=</span> []<span style="color:#a90d91">string</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">for</span> <span style="color:#000">k</span> <span style="color:#000">:=</span> <span style="color:#000">i</span>; <span style="color:#000">k</span> &lt; <span style="color:#000">j</span>; <span style="color:#000">k</span><span style="color:#000">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#000">values</span> = <span style="color:#a90d91">append</span>(<span style="color:#000">values</span>, <span style="color:#000">intermediate</span>[<span style="color:#000">k</span>].<span style="color:#000">Value</span>)  <span style="color:#177500">// 聚集具有相同key的中间键
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#000">output</span> <span style="color:#000">:=</span> <span style="color:#000">reducef</span>(<span style="color:#000">intermediate</span>[<span style="color:#000">i</span>].<span style="color:#000">Key</span>, <span style="color:#000">values</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// this is the correct format for each line of Reduce output.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">fmt</span>.<span style="color:#000">Fprintf</span>(<span style="color:#000">ofile</span>, <span style="color:#c41a16">&#34;%v %v\n&#34;</span>, <span style="color:#000">intermediate</span>[<span style="color:#000">i</span>].<span style="color:#000">Key</span>, <span style="color:#000">output</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">i</span> = <span style="color:#000">j</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">ofile</span>.<span style="color:#000">Close</span>()
</span></span></code></pre></div><p>这部分代码是<code>reduce</code>阶段，先对中间键进行排序，然后在调用<code>reducef</code>函数对同一key的所有中间键进行处理，最后将处理的结果写入硬盘保存。</p>
<h3 id="coordinator和worker"><code>coordinator</code>和<code>worker</code></h3>
<p><code>mrsequential.go</code>的代码读完之后，你可能对如何实现还是一头雾水。不过不要紧，我们对比实验要求一条条来分析。</p>
<p>首先，我们的mapreduce是分布式的，由一个<code>coordinator</code>（协调者）线程和多个 <code>worker</code>（工作者）线程组成，不是<code>mrsequential.go</code>这样的单线程程序。</p>
<p>回到 <code>mrcoordinator.go</code>和<code>mrworker.go</code>的代码中，我们可以知道<code>coordinator</code>（协调者）得到的参数只有待处理文件的位置；<code>worker</code>（工作者）得到的参数只有<code>map</code>和<code>reduce</code>函数。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#177500">// coordinator
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#a90d91">if</span> <span style="color:#a90d91">len</span>(<span style="color:#000">os</span>.<span style="color:#000">Args</span>) &lt; <span style="color:#1c01ce">2</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#000">fmt</span>.<span style="color:#000">Fprintf</span>(<span style="color:#000">os</span>.<span style="color:#000">Stderr</span>, <span style="color:#c41a16">&#34;Usage: mrcoordinator inputfiles...\n&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#000">os</span>.<span style="color:#000">Exit</span>(<span style="color:#1c01ce">1</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">m</span> <span style="color:#000">:=</span> <span style="color:#000">mr</span>.<span style="color:#000">MakeCoordinator</span>(<span style="color:#000">os</span>.<span style="color:#000">Args</span>[<span style="color:#1c01ce">1</span>:], <span style="color:#1c01ce">10</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">if</span> <span style="color:#a90d91">len</span>(<span style="color:#000">os</span>.<span style="color:#000">Args</span>) <span style="color:#000">!=</span> <span style="color:#1c01ce">2</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#000">fmt</span>.<span style="color:#000">Fprintf</span>(<span style="color:#000">os</span>.<span style="color:#000">Stderr</span>, <span style="color:#c41a16">&#34;Usage: mrworker xxx.so\n&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#000">os</span>.<span style="color:#000">Exit</span>(<span style="color:#1c01ce">1</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">mapf</span>, <span style="color:#000">reducef</span> <span style="color:#000">:=</span> <span style="color:#000">loadPlugin</span>(<span style="color:#000">os</span>.<span style="color:#000">Args</span>[<span style="color:#1c01ce">1</span>])
</span></span><span style="display:flex;"><span><span style="color:#000">mr</span>.<span style="color:#000">Worker</span>(<span style="color:#000">mapf</span>, <span style="color:#000">reducef</span>)
</span></span></code></pre></div><p>所以，我们没法像<code>mrsequential.go</code>一样直接开始运行。</p>
<blockquote>
<p>The workers will talk to the coordinator via RPC. Each worker process will ask the coordinator for a task, read the task&rsquo;s input from one or more files, execute the task, and write the task&rsquo;s output to one or more files.</p>
</blockquote>
<p>按照实验要求，worker需要通RPC向coordinator请求文件位置，然后读取文件内容，执行任务，在将任务的输出写入硬盘中。</p>
<p>回到<code>Worker</code>函数中</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">func</span> <span style="color:#000">Worker</span>(<span style="color:#000">mapf</span> <span style="color:#a90d91">func</span>(<span style="color:#a90d91">string</span>, <span style="color:#a90d91">string</span>) []<span style="color:#000">KeyValue</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#000">reducef</span> <span style="color:#a90d91">func</span>(<span style="color:#a90d91">string</span>, []<span style="color:#a90d91">string</span>) <span style="color:#a90d91">string</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// Your worker implementation here.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// uncomment to send the Example RPC to the coordinator.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#177500">// CallExample()
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>}
</span></span></code></pre></div><p>可以看到注释提示我们在这里发送RPC给coordinator。所以，接下来我们需要实现自己的RPC。</p>
<h3 id="rpc的实现">RPC的实现</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">Args</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#000">Index</span> <span style="color:#a90d91">int</span> <span style="color:#177500">// Index为-1代表请求任务，大于0时代表对应任务完成
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// 当worker完成map时传回的参数
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">IntermediateFiles</span> <span style="color:#a90d91">map</span>[<span style="color:#a90d91">int</span>]<span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// reduce完成时传回的参数
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">Reply</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#000">Done</span>  <span style="color:#a90d91">bool</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">Index</span> <span style="color:#a90d91">int</span> <span style="color:#177500">// 任务对应的编号
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// 当前任务为map时传给worker的参数
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">File</span>    <span style="color:#a90d91">string</span> <span style="color:#177500">// 文件名
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">NReduce</span> <span style="color:#a90d91">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// 当前任务为reduce时传给worker的参数
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">IntermediateFiles</span> []<span style="color:#a90d91">string</span> <span style="color:#177500">// 存放中间键的文件
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>}
</span></span></code></pre></div><p>上面是我定义的RPC参数。此处可以按照自己的想法增减参数。</p>
<p>参数定义完成后，还需要在<code>coordinator.go</code>中实现相应的函数，我实现的函数命名为<code>Task</code>。<code>Task</code>函数的具体内容要配合<code>coordinator.go</code>中的其他内容一同讲解，所以先跳过。</p>
<h3 id="worker的实现">Worker的实现</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">func</span> <span style="color:#000">Worker</span>(<span style="color:#000">mapf</span> <span style="color:#a90d91">func</span>(<span style="color:#a90d91">string</span>, <span style="color:#a90d91">string</span>) []<span style="color:#000">KeyValue</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#000">reducef</span> <span style="color:#a90d91">func</span>(<span style="color:#a90d91">string</span>, []<span style="color:#a90d91">string</span>) <span style="color:#a90d91">string</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">for</span> {  <span style="color:#177500">// worker完成一个任务继续请求新任务，直到coordinator通知退出才退出。所以需要加for循环
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">args</span> <span style="color:#000">:=</span> <span style="color:#000">Args</span>{}
</span></span><span style="display:flex;"><span>		<span style="color:#000">reply</span> <span style="color:#000">:=</span> <span style="color:#000">Reply</span>{}
</span></span><span style="display:flex;"><span>		<span style="color:#000">args</span>.<span style="color:#000">Index</span> = <span style="color:#000">-</span><span style="color:#1c01ce">1</span>  <span style="color:#177500">// Index为-1，代表请求任务
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">ok</span> <span style="color:#000">:=</span> <span style="color:#000">call</span>(<span style="color:#c41a16">&#34;Coordinator.Task&#34;</span>, <span style="color:#000">&amp;</span><span style="color:#000">args</span>, <span style="color:#000">&amp;</span><span style="color:#000">reply</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">if</span> <span style="color:#000">ok</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#177500">// 如果reply.Done为true，代表coordinate任务完成，所有worker退出
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#a90d91">if</span> <span style="color:#000">reply</span>.<span style="color:#000">Done</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">return</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">if</span> <span style="color:#000">reply</span>.<span style="color:#000">File</span> <span style="color:#000">!=</span> <span style="color:#c41a16">&#34;&#34;</span> { <span style="color:#177500">// file不为空，执行map任务
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>				<span style="color:#000">DoM</span>(<span style="color:#000">mapf</span>, <span style="color:#000">reply</span>.<span style="color:#000">File</span>, <span style="color:#000">reply</span>.<span style="color:#000">NReduce</span>, <span style="color:#000">reply</span>.<span style="color:#000">Index</span>)
</span></span><span style="display:flex;"><span>			} <span style="color:#a90d91">else</span> <span style="color:#a90d91">if</span> <span style="color:#000">reply</span>.<span style="color:#000">IntermediateFiles</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> { <span style="color:#177500">// intermediate不为空，执行reduce任务
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>				<span style="color:#000">DoR</span>(<span style="color:#000">reducef</span>, <span style="color:#000">reply</span>.<span style="color:#000">IntermediateFiles</span>, <span style="color:#000">reply</span>.<span style="color:#000">Index</span>)
</span></span><span style="display:flex;"><span>			} <span style="color:#a90d91">else</span> { <span style="color:#177500">// 两者都为空，代表未分配任务，休眠100ms再重新请求
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>				<span style="color:#000">time</span>.<span style="color:#000">Sleep</span>(<span style="color:#1c01ce">100</span> <span style="color:#000">*</span> <span style="color:#000">time</span>.<span style="color:#000">Millisecond</span>)
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		} <span style="color:#a90d91">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// RPC请求失败，重新调用
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>            <span style="color:#177500">// RPC请求失败可能是因为coordinator已经结束，所以此处也可直接退出。
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">fmt</span>.<span style="color:#000">Printf</span>(<span style="color:#c41a16">&#34;call failed!\n&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#000">time</span>.<span style="color:#000">Sleep</span>(<span style="color:#1c01ce">100</span> <span style="color:#000">*</span> <span style="color:#000">time</span>.<span style="color:#000">Millisecond</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>上面的代码是我的<code>Worker</code>函数实现。<code>DoM</code>和<code>DoR</code>是我自己定义的函数，将具体的Map和Reduce执行过程从中剥离出来，使代码更具可读性。</p>
<h3 id="dom函数-和-dor函数"><code>DoM</code>函数 和 <code>DoR</code>函数</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">func</span> <span style="color:#000">DoM</span>(<span style="color:#000">mapf</span> <span style="color:#a90d91">func</span>(<span style="color:#a90d91">string</span>, <span style="color:#a90d91">string</span>) []<span style="color:#000">KeyValue</span>, <span style="color:#000">filename</span> <span style="color:#a90d91">string</span>, <span style="color:#000">NReduce</span>, <span style="color:#000">index</span> <span style="color:#a90d91">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// 读取task输入
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">file</span>, <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">os</span>.<span style="color:#000">Open</span>(<span style="color:#000">filename</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#000">log</span>.<span style="color:#000">Fatalf</span>(<span style="color:#c41a16">&#34;cannot open %v&#34;</span>, <span style="color:#000">filename</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#000">content</span>, <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">ioutil</span>.<span style="color:#000">ReadAll</span>(<span style="color:#000">file</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#000">file</span>.<span style="color:#000">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// 调用mapf函数对输入进行处理
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">kva</span> <span style="color:#000">:=</span> <span style="color:#000">mapf</span>(<span style="color:#000">filename</span>, <span style="color:#a90d91">string</span>(<span style="color:#000">content</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">intermediates</span> <span style="color:#000">:=</span> <span style="color:#a90d91">make</span>(<span style="color:#a90d91">map</span>[<span style="color:#a90d91">int</span>][]<span style="color:#000">KeyValue</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">for</span> <span style="color:#000">_</span>, <span style="color:#000">v</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">kva</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// 根据Reduce worker的个数，将中间键进行分配
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">intermediates</span>[<span style="color:#000">ihash</span>(<span style="color:#000">v</span>.<span style="color:#000">Key</span>)<span style="color:#000">%</span><span style="color:#000">NReduce</span>] = <span style="color:#a90d91">append</span>(<span style="color:#000">intermediates</span>[<span style="color:#000">ihash</span>(<span style="color:#000">v</span>.<span style="color:#000">Key</span>)<span style="color:#000">%</span><span style="color:#000">NReduce</span>], <span style="color:#000">v</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">files</span> <span style="color:#000">:=</span> <span style="color:#a90d91">make</span>(<span style="color:#a90d91">map</span>[<span style="color:#a90d91">int</span>]<span style="color:#a90d91">string</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// 将中间键写入对应的中间文件中
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#a90d91">for</span> <span style="color:#000">k</span>, <span style="color:#000">v</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">intermediates</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#000">filename</span> <span style="color:#000">:=</span> <span style="color:#000">fmt</span>.<span style="color:#000">Sprintf</span>(<span style="color:#c41a16">&#34;mr-%d-%d&#34;</span>, <span style="color:#000">index</span>, <span style="color:#000">k</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#000">files</span>[<span style="color:#000">k</span>] = <span style="color:#000">filename</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">file</span>, <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">os</span>.<span style="color:#000">Create</span>(<span style="color:#000">filename</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#000">log</span>.<span style="color:#000">Fatalf</span>(<span style="color:#c41a16">&#34;cannot create %v&#34;</span>, <span style="color:#000">filename</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#000">enc</span> <span style="color:#000">:=</span> <span style="color:#000">json</span>.<span style="color:#000">NewEncoder</span>(<span style="color:#000">file</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> <span style="color:#000">_</span>, <span style="color:#000">kv</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">v</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#000">enc</span>.<span style="color:#000">Encode</span>(<span style="color:#000">&amp;</span><span style="color:#000">kv</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// 向coordinator发送RPC请求，代表对应任务已经完成
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">args</span> <span style="color:#000">:=</span> <span style="color:#000">Args</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#000">reply</span> <span style="color:#000">:=</span> <span style="color:#000">Reply</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#000">args</span>.<span style="color:#000">Index</span> = <span style="color:#000">index</span>  <span style="color:#177500">// index代表对应任务id
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">args</span>.<span style="color:#000">IntermediateFiles</span> = <span style="color:#000">files</span>  <span style="color:#177500">// files代表生成的中间文件位置
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">call</span>(<span style="color:#c41a16">&#34;Coordinator.Task&#34;</span>, <span style="color:#000">&amp;</span><span style="color:#000">args</span>, <span style="color:#000">&amp;</span><span style="color:#000">reply</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>上面的代码就是我的<code>DoM</code>函数，也就是处理Map任务的逻辑。可以看出前半部分代码与<code>mrsequential.go</code>中的map部分几乎一模一样，整体上只是多了将中间键按reduce worker数量进行分配后写入中间文件和任务完成后发送请求的操作。增加这些操作的根据是lab1的 <strong>A few rules</strong> 和 <strong>Hints</strong> 。</p>
<blockquote>
<ul>
<li>The map phase should divide the intermediate keys into buckets for <code>nReduce</code> reduce tasks, where <code>nReduce</code> is the number of reduce tasks &ndash; argument that <code>main/mrcoordinator.go</code> passes to <code>MakeCoordinator()</code>. So, each mapper needs to create <code>nReduce</code> intermediate files for consumption by the reduce tasks.</li>
</ul>
</blockquote>
<p>map阶段应该把中间键分成<code>nReduce</code>个桶，其中<code>nReduce</code>是reduce任务的数量 &ndash; <code>main/mrcoordinator.go</code>传递给<code>MakeCoordinator()</code>的参数。因此，每个映射器需要创建<code>nReduce</code>中间文件，供reducd任务使用。</p>
<blockquote>
<ul>
<li>
<p>A reasonable naming convention for intermediate files is <code>mr-X-Y</code>, where X is the Map task number, and Y is the reduce task number.</p>
</li>
<li>
<p>The worker&rsquo;s map task code will need a way to store intermediate key/value pairs in files in a way that can be correctly read back during reduce tasks. One possibility is to use Go&rsquo;s <code>encoding/json</code> package. To write key/value pairs in JSON format to an open file:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#000">enc</span> <span style="color:#000">:=</span> <span style="color:#000">json</span>.<span style="color:#000">NewEncoder</span>(<span style="color:#000">file</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">for</span> <span style="color:#000">_</span>, <span style="color:#000">kv</span> <span style="color:#000">:=</span> <span style="color:#000">...</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">enc</span>.<span style="color:#000">Encode</span>(<span style="color:#000">&amp;</span><span style="color:#000">kv</span>)
</span></span></code></pre></div></li>
<li>
<p>The map part of your worker can use the <code>ihash(key)</code> function (in <code>worker.go</code>) to pick the reduce task for a given key.</p>
</li>
</ul>
</blockquote>
<p>如果对此部分有所疑惑，可以去看看MapReduce论文的<a href="https://fengluodb.github.io/post/MapReduce/#31-%E5%AE%9E%E7%8E%B0%E6%A6%82%E8%A7%88">实现概览</a>，你会发现这部分代码的功能在上面都有着对应，能加深你对代码和论文的理解。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">func</span> <span style="color:#000">DoR</span>(<span style="color:#000">reducef</span> <span style="color:#a90d91">func</span>(<span style="color:#a90d91">string</span>, []<span style="color:#a90d91">string</span>) <span style="color:#a90d91">string</span>, <span style="color:#000">intermediateFiles</span> []<span style="color:#a90d91">string</span>, <span style="color:#000">index</span> <span style="color:#a90d91">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// 从中间文件中读取中间键
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">intermediate</span> <span style="color:#000">:=</span> []<span style="color:#000">KeyValue</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">for</span> <span style="color:#000">_</span>, <span style="color:#000">filename</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">intermediateFiles</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#000">file</span>, <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">os</span>.<span style="color:#000">Open</span>(<span style="color:#000">filename</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#000">log</span>.<span style="color:#000">Fatalf</span>(<span style="color:#c41a16">&#34;cannot open %v&#34;</span>, <span style="color:#000">filename</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#000">dec</span> <span style="color:#000">:=</span> <span style="color:#000">json</span>.<span style="color:#000">NewDecoder</span>(<span style="color:#000">file</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">var</span> <span style="color:#000">kv</span> <span style="color:#000">KeyValue</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">dec</span>.<span style="color:#000">Decode</span>(<span style="color:#000">&amp;</span><span style="color:#000">kv</span>); <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">break</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#000">intermediate</span> = <span style="color:#a90d91">append</span>(<span style="color:#000">intermediate</span>, <span style="color:#000">kv</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">oname</span> <span style="color:#000">:=</span> <span style="color:#000">fmt</span>.<span style="color:#000">Sprintf</span>(<span style="color:#c41a16">&#34;mr-out-%d&#34;</span>, <span style="color:#000">index</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#000">ofile</span>, <span style="color:#000">_</span> <span style="color:#000">:=</span> <span style="color:#000">os</span>.<span style="color:#000">Create</span>(<span style="color:#000">oname</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">sort</span>.<span style="color:#000">Sort</span>(<span style="color:#000">ByKey</span>(<span style="color:#000">intermediate</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// 与mrsequential.go中的reduce部分类似
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#177500">// 聚集相同key的键值对，在对这些键值对进行reduce操作
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#a90d91">for</span> <span style="color:#000">i</span> <span style="color:#000">:=</span> <span style="color:#1c01ce">0</span>; <span style="color:#000">i</span> &lt; <span style="color:#a90d91">len</span>(<span style="color:#000">intermediate</span>); {
</span></span><span style="display:flex;"><span>		<span style="color:#000">j</span> <span style="color:#000">:=</span> <span style="color:#000">i</span> <span style="color:#000">+</span> <span style="color:#1c01ce">1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> <span style="color:#000">j</span> &lt; <span style="color:#a90d91">len</span>(<span style="color:#000">intermediate</span>) <span style="color:#000">&amp;&amp;</span> <span style="color:#000">intermediate</span>[<span style="color:#000">j</span>].<span style="color:#000">Key</span> <span style="color:#000">==</span> <span style="color:#000">intermediate</span>[<span style="color:#000">i</span>].<span style="color:#000">Key</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#000">j</span><span style="color:#000">++</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#000">values</span> <span style="color:#000">:=</span> []<span style="color:#a90d91">string</span>{}
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> <span style="color:#000">k</span> <span style="color:#000">:=</span> <span style="color:#000">i</span>; <span style="color:#000">k</span> &lt; <span style="color:#000">j</span>; <span style="color:#000">k</span><span style="color:#000">++</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#000">values</span> = <span style="color:#a90d91">append</span>(<span style="color:#000">values</span>, <span style="color:#000">intermediate</span>[<span style="color:#000">k</span>].<span style="color:#000">Value</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#000">output</span> <span style="color:#000">:=</span> <span style="color:#000">reducef</span>(<span style="color:#000">intermediate</span>[<span style="color:#000">i</span>].<span style="color:#000">Key</span>, <span style="color:#000">values</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// this is the correct format for each line of Reduce output.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">fmt</span>.<span style="color:#000">Fprintf</span>(<span style="color:#000">ofile</span>, <span style="color:#c41a16">&#34;%v %v\n&#34;</span>, <span style="color:#000">intermediate</span>[<span style="color:#000">i</span>].<span style="color:#000">Key</span>, <span style="color:#000">output</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">i</span> = <span style="color:#000">j</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#000">ofile</span>.<span style="color:#000">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 向coordinator发送RPC请求，代表对应任务已经完成
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">args</span> <span style="color:#000">:=</span> <span style="color:#000">Args</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#000">reply</span> <span style="color:#000">:=</span> <span style="color:#000">Reply</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#000">args</span>.<span style="color:#000">Index</span> = <span style="color:#000">index</span>  <span style="color:#177500">// index代表对应任务的id
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">call</span>(<span style="color:#c41a16">&#34;Coordinator.Task&#34;</span>, <span style="color:#000">&amp;</span><span style="color:#000">args</span>, <span style="color:#000">&amp;</span><span style="color:#000">reply</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>上面的代码就是我的<code>DoR</code>函数，也就是处理Reduce任务的逻辑。可以看出，整体上代码与<code>mrsequential.go</code>中的reduce部分相差不大，只是多了读取中间文件和任务完成后发送请求的操作。代码中的文件命名是依据lab1的 <strong>A few rules</strong></p>
<blockquote>
<ul>
<li>The worker implementation should put the output of the X&rsquo;th reduce task in the file <code>mr-out-X</code>.</li>
<li>A <code>mr-out-X</code> file should contain one line per Reduce function output. The line should be generated with the Go <code>&quot;%v %v&quot;</code> format, called with the key and value. Have a look in <code>main/mrsequential.go</code> for the line commented &ldquo;this is the correct format&rdquo;. The test script will fail if your implementation deviates too much from this format.</li>
</ul>
</blockquote>
<p>读取中间文件的部分是依据lab1的<strong>Hints</strong></p>
<blockquote>
<p>and to read such a file back:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">dec</span> <span style="color:#000">:=</span> <span style="color:#000">json</span>.<span style="color:#000">NewDecoder</span>(<span style="color:#000">file</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">for</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">var</span> <span style="color:#000">kv</span> <span style="color:#000">KeyValue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">dec</span>.<span style="color:#000">Decode</span>(<span style="color:#000">&amp;</span><span style="color:#000">kv</span>); <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a90d91">break</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000">kva</span> = <span style="color:#a90d91">append</span>(<span style="color:#000">kva</span>, <span style="color:#000">kv</span>)
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div></blockquote>
<p>到此，我们的<code>worker</code>就已经全部完成了。接下来，我们开始思考如何实现<code>coordinator</code>。</p>
<h3 id="coordinator的实现">Coordinator的实现</h3>
<p>与<code>worker</code>的实现相比，<code>coordinator</code>的实现想起来就较为复杂一些。一些逻辑在lab1的主页中也没有提示，需要我们对论文中的内容较为熟悉才能想到。</p>
<p>我们是从<code>coordinator</code>的RPC函数开始实现。不过，在此之前，我们先定义好<code>Coordinator</code>结构体。想一想，我们需要在<code>Coordinator</code>中填充什么参数。</p>
<p>根据定义的RPC参数，我们可以增加以下内容：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">Coordinator</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// Your definitions here.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">flag</span>              <span style="color:#a90d91">int</span> <span style="color:#177500">// 0代表map阶段，1代表reduce阶段，2代表所有工作完成
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">files</span>             []<span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">intermediateFiles</span> <span style="color:#a90d91">map</span>[<span style="color:#a90d91">int</span>][]<span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">nReduce</span>           <span style="color:#a90d91">int</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>flag</code>标识现在的状态，根据状态传输相应的参数；<code>files</code>存储原始文件的位置，<code>intermediateFiles</code>存储每个reduce worker对应的中间文件的位置；<code>nReduce</code>是reduce worker的数量。</p>
<p>然后想想，还需要增加参数吗？</p>
<p>当然，只有这些参数我们无法得知分配任务时那些任务需要分配。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">Coordinator</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// Your definitions here.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">mu</span>                <span style="color:#000">sync</span>.<span style="color:#000">Mutex</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">flag</span>              <span style="color:#a90d91">int</span> <span style="color:#177500">// 0代表map阶段，1代表reduce阶段，2代表所有工作完成
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">files</span>             []<span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">intermediateFiles</span> <span style="color:#a90d91">map</span>[<span style="color:#a90d91">int</span>][]<span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">nReduce</span>           <span style="color:#a90d91">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">queue1</span> []<span style="color:#000">Task</span> <span style="color:#177500">// 任务队列1，存放待分配的任务
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">Task</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#000">index</span>  <span style="color:#a90d91">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">status</span> <span style="color:#a90d91">int</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>所以，我们添加<code>queue1</code>，存放待分配的任务。并且，因为多个worker同时调用RPC时，会并发读写任务队列，所以还需要加锁。</p>
<p>下面，就是<code>Coordinator</code>的生成函数</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">func</span> <span style="color:#000">MakeCoordinator</span>(<span style="color:#000">files</span> []<span style="color:#a90d91">string</span>, <span style="color:#000">nReduce</span> <span style="color:#a90d91">int</span>) <span style="color:#000">*</span><span style="color:#000">Coordinator</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#000">c</span> <span style="color:#000">:=</span> <span style="color:#000">Coordinator</span>{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// Your code here.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">c</span>.<span style="color:#000">files</span> = <span style="color:#000">files</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">c</span>.<span style="color:#000">nReduce</span> = <span style="color:#000">nReduce</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">c</span>.<span style="color:#000">flag</span> = <span style="color:#1c01ce">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">c</span>.<span style="color:#000">intermediateFiles</span> = <span style="color:#a90d91">make</span>(<span style="color:#a90d91">map</span>[<span style="color:#a90d91">int</span>][]<span style="color:#a90d91">string</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// 在queue1中存放待分配map任务
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#a90d91">for</span> <span style="color:#000">i</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">files</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#000">task</span> <span style="color:#000">:=</span> <span style="color:#000">Task</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#000">index</span>:  <span style="color:#000">i</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#000">status</span>: <span style="color:#000">Wait</span>,
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#000">c</span>.<span style="color:#000">queue1</span> = <span style="color:#a90d91">append</span>(<span style="color:#000">c</span>.<span style="color:#000">queue1</span>, <span style="color:#000">task</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">c</span>.<span style="color:#000">server</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">return</span> <span style="color:#000">&amp;</span><span style="color:#000">c</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>接下来，我们实现<code>Task</code>函数。</p>
<ol>
<li>首先，根据<code>args.Index</code>判断<code>worker</code>是在请求任务，还是在回复任务已经完成；</li>
<li>如果是请求任务，判断<code>queue1</code>是否为空，如果不为空，则分配任务；</li>
<li>如果是worker在回复任务已完成，检查该任务是否执行过，如果没有，更新参数。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">func</span> (<span style="color:#000">c</span> <span style="color:#000">*</span><span style="color:#000">Coordinator</span>) <span style="color:#000">Task</span>(<span style="color:#000">args</span> <span style="color:#000">*</span><span style="color:#000">Args</span>, <span style="color:#000">reply</span> <span style="color:#000">*</span><span style="color:#000">Reply</span>) <span style="color:#a90d91">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">if</span> <span style="color:#000">args</span>.<span style="color:#000">Index</span> <span style="color:#000">==</span> <span style="color:#000">-</span><span style="color:#1c01ce">1</span> { <span style="color:#177500">// worker请求任务
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">c</span>.<span style="color:#000">mu</span>.<span style="color:#000">Lock</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">if</span> <span style="color:#000">c</span>.<span style="color:#000">flag</span> <span style="color:#000">==</span> <span style="color:#1c01ce">2</span> { <span style="color:#177500">// flag为2，代表所有任务完成，等待退出
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">reply</span>.<span style="color:#000">Done</span> = <span style="color:#a90d91">true</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">if</span> <span style="color:#a90d91">len</span>(<span style="color:#000">c</span>.<span style="color:#000">queue1</span>) <span style="color:#000">!=</span> <span style="color:#1c01ce">0</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#000">task</span> <span style="color:#000">:=</span> <span style="color:#000">c</span>.<span style="color:#000">queue1</span>[<span style="color:#1c01ce">0</span>]
</span></span><span style="display:flex;"><span>			<span style="color:#000">task</span>.<span style="color:#000">status</span> = <span style="color:#000">Doing</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">c</span>.<span style="color:#000">queue1</span> = <span style="color:#000">c</span>.<span style="color:#000">queue1</span>[<span style="color:#1c01ce">1</span>:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">reply</span>.<span style="color:#000">Index</span> = <span style="color:#000">task</span>.<span style="color:#000">index</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">if</span> <span style="color:#000">c</span>.<span style="color:#000">flag</span> <span style="color:#000">==</span> <span style="color:#1c01ce">0</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#000">reply</span>.<span style="color:#000">File</span> = <span style="color:#000">c</span>.<span style="color:#000">files</span>[<span style="color:#000">task</span>.<span style="color:#000">index</span>]
</span></span><span style="display:flex;"><span>				<span style="color:#000">reply</span>.<span style="color:#000">NReduce</span> = <span style="color:#000">c</span>.<span style="color:#000">nReduce</span>
</span></span><span style="display:flex;"><span>			} <span style="color:#a90d91">else</span> <span style="color:#a90d91">if</span> <span style="color:#000">c</span>.<span style="color:#000">flag</span> <span style="color:#000">==</span> <span style="color:#1c01ce">1</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#000">reply</span>.<span style="color:#000">IntermediateFiles</span> = <span style="color:#000">c</span>.<span style="color:#000">intermediateFiles</span>[<span style="color:#000">task</span>.<span style="color:#000">index</span>]
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#000">c</span>.<span style="color:#000">mu</span>.<span style="color:#000">Unlock</span>()
</span></span><span style="display:flex;"><span>	} <span style="color:#a90d91">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#000">c</span>.<span style="color:#000">mu</span>.<span style="color:#000">Lock</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">if</span> <span style="color:#000">args</span>.<span style="color:#000">IntermediateFiles</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> <span style="color:#000">&amp;&amp;</span> <span style="color:#000">c</span>.<span style="color:#000">flag</span> <span style="color:#000">==</span> <span style="color:#1c01ce">0</span> { <span style="color:#177500">// worker完成map后传回的参数
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#a90d91">for</span> <span style="color:#000">k</span>, <span style="color:#000">v</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">args</span>.<span style="color:#000">IntermediateFiles</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#000">c</span>.<span style="color:#000">intermediateFiles</span>[<span style="color:#000">k</span>] = <span style="color:#a90d91">append</span>(<span style="color:#000">c</span>.<span style="color:#000">intermediateFiles</span>[<span style="color:#000">k</span>], <span style="color:#000">v</span>)
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">c</span>.<span style="color:#000">mu</span>.<span style="color:#000">Unlock</span>()
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">return</span> <span style="color:#a90d91">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这样，我们的<code>Coordinator</code>就算实现了，你可以开始测试。但是，你会发现部分测试无法通过，如<code>crash</code>。这时，我们回到<code>nocrash.go</code>看其中的<code>map</code>和<code>reduce</code>函数，你会发现两个函数开始都会调用<code>maybeCrash</code>函数，随机Crash。也就是说，<code>coordinator</code>分配给worker的任务可能没有成功执行，worker就退出了。</p>
<p>这说明，我们的<code>coordinator</code>缺失容错机制，当一个任务长时间没过完成时，我们要将它重新分配。对应论文中的这部分内容：</p>
<blockquote>
<p>The master pings every worker periodically. If no response is received from a worker in a certain amount of time, the master marks the worker as failed. Any map tasks completed by <strong>the worker</strong> are reset back to their initial idle state, and therefore become eligible for scheduling on other workers.</p>
</blockquote>
<p>所以，我们需要增加一个<code>Check</code>函数，定期检查哪些任务长时间未完成，并将这些任务重新分配。同时，我们还需要对<code>Coordinator.go</code>中的其他函数进行部分修改。</p>
<p>到此，lab1的整体流程都已经介绍完毕，剩下的部分修改就不再介绍了。读者自行思考，完整代码，以后会给出GitHub链接。</p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://fengluodb.github.io">枫落</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://fengluodb.github.io/post/lab1/">https://fengluodb.github.io/post/lab1/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/MapReduce/">Mit 6.824系列(一): MapReduce论文翻译</a></li>
        
        <li><a href="/archives/">归档</a></li>
        
        <li><a href="/serach/">搜索</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/golang'>golang</a></li>
                
                <li><a href='/tags/%E5%88%86%E5%B8%83%E5%BC%8F'>分布式</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "fengluodb/discuss"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2022 <a href="https://fengluodb.github.io">枫落的博客 By 枫落</a>
        
    </div>
    <br />
</footer>




<script type="text/javascript">
    window.MathJax = {
        tex2jax: {
            inlineMath: [['$', '$']],
            processEscapes: true
        }
    };
</script>
<script
    src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML'
    async></script><script
    src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
<script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://fengluodb.github.io/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://fengluodb.github.io">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://fengluodb.github.io/post/lab1/" title="Mit 6.824系列(二): Lab1 MapReduce">
            <svg t="1648977439393" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="2205" data-darkreader-inline-fill="" width="20" height="16">
                <path
                    d="M682.61 398.43H284.52v56.87h398.09v-56.87zM284.52 796.52h398.09v-56.87H284.52v56.87z m0-170.61h511.83v-56.87H284.52v56.87z m682.44-386.772v-11.317h-11.318L739.48 11.658V0.341h-11.317L727.82 0l-0.34 0.341h-556.7c-62.84 0-113.74 50.899-113.74 113.74v796.18c0 62.84 50.9 113.739 113.74 113.739h682.44c62.84 0 113.74-50.899 113.74-113.74V243.403l2.104-2.104-2.105-2.16zM739.48 92.072l135.748 135.749H739.48V92.072zM910.09 910.26c0 31.392-25.478 56.87-56.87 56.87H170.78c-31.392 0-56.87-25.478-56.87-56.87V114.081c0-31.392 25.478-56.87 56.87-56.87h511.83v227.48h227.48v625.57z"
                    p-id="2206" fill="#1296db" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#316986;">
                </path>
            </svg>
            Mit 6.824系列(二): Lab1 MapReduce
        </a>
    </li>
    
    <li>
        <a href="https://fengluodb.github.io/post/MapReduce/" title="Mit 6.824系列(一): MapReduce论文翻译">
            <svg t="1648977439393" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="2205" data-darkreader-inline-fill="" width="20" height="16">
                <path
                    d="M682.61 398.43H284.52v56.87h398.09v-56.87zM284.52 796.52h398.09v-56.87H284.52v56.87z m0-170.61h511.83v-56.87H284.52v56.87z m682.44-386.772v-11.317h-11.318L739.48 11.658V0.341h-11.317L727.82 0l-0.34 0.341h-556.7c-62.84 0-113.74 50.899-113.74 113.74v796.18c0 62.84 50.9 113.739 113.74 113.739h682.44c62.84 0 113.74-50.899 113.74-113.74V243.403l2.104-2.104-2.105-2.16zM739.48 92.072l135.748 135.749H739.48V92.072zM910.09 910.26c0 31.392-25.478 56.87-56.87 56.87H170.78c-31.392 0-56.87-25.478-56.87-56.87V114.081c0-31.392 25.478-56.87 56.87-56.87h511.83v227.48h227.48v625.57z"
                    p-id="2206" fill="#1296db" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#316986;">
                </path>
            </svg>
            Mit 6.824系列(一): MapReduce论文翻译
        </a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li>
        <a href="https://fengluodb.github.io/categories/golang/">
            <svg t="1648978838653" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="7618" data-darkreader-inline-fill="" width="20" height="20">
                <path
                    d="M256 734.101333v64H170.666667v-64h85.333333z m597.333333 0v64H298.666667v-64h554.666666zM256 493.184v64H170.666667v-64h85.333333z m597.333333 0v64H298.666667v-64h554.666666zM256 252.245333v64H170.666667v-64h85.333333z m597.333333 0v64H298.666667v-64h554.666666z"
                    p-id="7619" fill="#1296db" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#316986;">
                </path>
            </svg>
            golang (2)
        </a>
    </li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/series/'>系列</a></h3>
<ul class="widget-list">
    
    <li>
        <a href="https://fengluodb.github.io/series/6.824/">
            <svg t="1648978987470" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="8471" data-darkreader-inline-fill="" width="20" height="20">
                <path
                    d="M126.373 96.666l0 0 0 0zM892.107 319.978q18.694 26.633 8.411 60.266l-128.472 423.275q-8.882 29.904-35.738 50.22t-57.231 20.328l-431.215 0q-35.974 0-69.383-24.998t-46.492-61.431q-11.212-31.304-0.929-59.337 0-1.87 1.4-12.609t1.87-17.28q0.471-3.742-1.4-10.047t-1.4-9.105q0.929-5.14 3.742-9.811t7.705-10.975 7.705-10.976q10.739-17.752 21.022-42.75t14.01-42.75q1.4-4.671 0.235-14.01t-0.235-13.082q1.4-5.14 7.941-13.082t7.941-10.739q9.811-16.822 19.623-42.984t11.681-42.043q0.471-4.199-1.164-14.952t0.235-13.082q1.87-6.069 10.283-14.245t10.283-10.517q8.882-12.153 19.858-39.48t12.846-45.079q0.472-3.742-1.4-11.917t-0.929-12.375q0.929-3.742 4.199-8.411t8.411-10.739 7.941-9.811q3.742-5.612 7.705-14.245t7.012-16.352 7.469-16.823 9.105-14.952 12.375-10.975 16.822-5.377 22.186 2.565l-0.471 1.4q17.753-4.199 23.821-4.199l355.539 0q34.573 0 53.255 26.164t8.411 60.737l-128.015 423.275q-16.822 55.597-33.41 71.711t-60.031 16.117l-405.995 0q-12.609 0-17.752 7.012-5.14 7.469-0.471 20.093 11.212 32.703 67.278 32.703l431.215 0q13.553 0 26.163-7.247t16.352-19.387l140.153-461.119q3.27-10.282 2.342-26.633 17.752 7.012 27.562 20.093zM395.014 320.921q-1.87 6.069 0.929 10.517t9.34 4.435l284.049 0q6.069 0 11.917-4.435t7.705-10.517l9.811-29.904q1.87-6.069-0.929-10.517t-9.34-4.435l-284.049 0q-6.069 0-11.918 4.435t-7.705 10.517zM356.228 440.524q-1.87 6.069 0.929 10.517t9.34 4.435l284.049 0q6.069 0 11.917-4.435t7.705-10.517l9.811-29.904q1.87-6.069-0.929-10.517t-9.34-4.435l-284.049 0q-6.069 0-11.917 4.435t-7.705 10.517z"
                    p-id="8472" fill="#1296db" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#316986;">
                </path>
            </svg>
            6.824 (2)
        </a>
    </li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://fengluodb.github.io/tags/golang/">
        <svg t="1648977812460" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
            p-id="3043" data-darkreader-inline-fill="" width="16" height="16">
            <path
                d="M985.6 473.6 985.6 473.6l-256 256-256 256 0 0C454.4 1011.2 422.4 1024 384 1024c-38.4 0-70.4-12.8-89.6-38.4l0 0-256-256 0 0C12.8 710.4 0 678.4 0 640c0-38.4 12.8-70.4 38.4-89.6l0 0 256-256 256-256 0 0C569.6 12.8 601.6 0 640 0l256 0c70.4 0 128 57.6 128 128l0 256C1024 422.4 1011.2 454.4 985.6 473.6zM768 128c-70.4 0-128 57.6-128 128 0 70.4 57.6 128 128 128 70.4 0 128-57.6 128-128C896 185.6 838.4 128 768 128z"
                p-id="3044" fill="#1296db" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#316986;">
            </path>
        </svg>
        golang
    </a>
    
    <a href="https://fengluodb.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">
        <svg t="1648977812460" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
            p-id="3043" data-darkreader-inline-fill="" width="16" height="16">
            <path
                d="M985.6 473.6 985.6 473.6l-256 256-256 256 0 0C454.4 1011.2 422.4 1024 384 1024c-38.4 0-70.4-12.8-89.6-38.4l0 0-256-256 0 0C12.8 710.4 0 678.4 0 640c0-38.4 12.8-70.4 38.4-89.6l0 0 256-256 256-256 0 0C569.6 12.8 601.6 0 640 0l256 0c70.4 0 128 57.6 128 128l0 256C1024 422.4 1011.2 454.4 985.6 473.6zM768 128c-70.4 0-128 57.6-128 128 0 70.4 57.6 128 128 128 70.4 0 128-57.6 128-128C896 185.6 838.4 128 768 128z"
                p-id="3044" fill="#1296db" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#316986;">
            </path>
        </svg>
        分布式
    </a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://fengluodb.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>